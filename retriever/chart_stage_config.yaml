# Example config for chart extraction.
#
# Intended usage (once the chart stage CLI is wired up similarly to table stage):
#   - `retriever chart stage run --config <this.yaml> --input <primitives.parquet>`
#   - `retriever local stage4 run --config <this.yaml> --input <primitives.parquet>`
#
# This YAML is parsed into `nv_ingest_api.internal.schemas.extract.extract_chart_schema.ChartExtractorSchema`
# via `retriever.chart.config.load_chart_extractor_schema_from_dict`.
#
# IMPORTANT:
# `endpoint_config.yolox_endpoints` and `endpoint_config.ocr_endpoints` must each provide at least one
# endpoint (gRPC or HTTP). Both cannot be null/empty for either entry (validated by the schema).
#

# Optional worker settings
max_queue_size: 1
n_workers: 2
raise_on_failure: false

# Endpoint configuration for chart extraction (YOLOX graphic-elements + OCR).
endpoint_config:
  # Optional auth token for secured services (NIM / hosted endpoints)
  auth_token: null

  # Tuple/list in the form: [grpc, http]
  #
  # Chart extraction uses the YOLOX *graphic-elements* model (not page-elements).
  #
  # For the provided `docker-compose.yaml`, the host-mapped ports are:
  #   - graphic-elements HTTP: 8003 (container 8000)
  #   - graphic-elements gRPC: 8004 (container 8001)
  #
  # If you're running from inside the docker compose network instead, these often look like:
  #   - "graphic-elements:8001" and "http://graphic-elements:8000/v1/infer"
  yolox_endpoints: ["localhost:8004", "http://localhost:8003/v1/infer"]
  # Optional; if omitted it is inferred from which endpoint is present.
  # yolox_infer_protocol: grpc

  # OCR model endpoints (same pattern: [grpc, http]).
  # For the provided `docker-compose.yaml`, the host-mapped ports are:
  #   - ocr HTTP: 8019 (container 8000)
  #   - ocr gRPC: 8010 (container 8001)
  ocr_endpoints: ["localhost:8010", "http://localhost:8019/v1/infer"]
  # Optional; if omitted it is inferred from which endpoint is present.
  # ocr_infer_protocol: grpc

  # Optional performance knobs
  nim_batch_size: 2
  workers_per_progress_engine: 5

