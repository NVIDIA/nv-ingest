# nv-ingest Test Configuration
# Edit the 'active' section directly to configure your test runs

# Active configuration (used by default when running tests)
active:
  # Dataset configuration
  dataset_dir: /path/to/dataset
  test_name: null  # Auto-generated if null

  # API configuration
  api_version: v2 # v1 or v2
  pdf_split_page_count: null # V2 only: pages per chunk (null = default 32)

  # Infrastructure
  hostname: localhost
  readiness_timeout: 600
  
  # Deployment configuration
  deployment_type: docker-compose  # Options: docker-compose, helm
  
  # Docker Compose specific
  profiles:
    - retrieval
    - table-structure
  
  # Helm specific (only used when deployment_type: helm)
  helm_release: nv-ingest
  helm_namespace: default
  helm_values_file: .helm-overrides.yaml  # Optional: path to values file
  service_port: 7670  # Port for accessing services (for Helm deployments)
  # helm_values:  # Optional: inline Helm values
  #   api.enabled: true
  #   redis.enabled: true

  # Runtime configuration
  sparse: false  # Use sparse embeddings
  gpu_search: false  # Use GPU for search
  embedding_model: auto  # auto-detect or specify model name

  # Extraction configuration
  extract_text: true
  extract_tables: true
  extract_charts: true
  extract_images: false
  extract_infographics: true
  text_depth: page
  # table_output_format: markdown

  # Optional pipeline steps
  enable_caption: false  # Enable image captioning (ensure vlm profile is enabled)
  caption_prompt: null  # Override caption user prompt (null = service default)
  caption_system_prompt: null  # Set "/think" or "/no_think" to control reasoning (null = service default)

  enable_split: false  # Enable text chunking
  split_chunk_size: 1024  # Chunk size for text splitting
  split_chunk_overlap: 150  # Overlap for text splitting
  enable_image_storage: false  # Enable server-side image storage (defaults to MinIO; set IMAGE_STORAGE_URI=file://... to opt into disk)

  # Storage configuration
  spill_dir: /tmp/spill
  artifacts_dir: null  # null = use default (tools/harness/artifacts)
  collection_name: null  # null = auto-generated

  # Custom UDF Configs - add specific udf configs here if needed.
  llm_summarization_model: nvdev/nvidia/llama-3.1-nemotron-70b-instruct  # LLM for summarization - this does NOT propagate to the UDF, but useful for artifact storage.

# Recall configuration (only used when running recall or e2e_recall tests)
recall:
  recall_dataset: null
  reranker_mode: none  # Options: "none", "with", "both"

  # Recall evaluation settings
  recall_top_k: 10
  ground_truth_dir: null

# Pre-configured datasets
# Each dataset includes path, extraction settings, and recall evaluator
# Use: uv run nv-ingest-harness-run --case=e2e --dataset=bo767
datasets:
  bo767:
    path: /path/to/bo767
    extract_text: true
    extract_tables: true
    extract_charts: true
    extract_images: false
    extract_infographics: false
    recall_dataset: bo767  # Evaluator for recall testing

  earnings:
    path: /path/to/earnings_consulting
    extract_text: true
    extract_tables: true
    extract_charts: true
    extract_images: false
    extract_infographics: false
    recall_dataset: earnings  # Evaluator for recall testing

  bo20:
    path: /path/to/bo20
    extract_text: true
    extract_tables: true
    extract_charts: true
    extract_images: true
    extract_infographics: true
    recall_dataset: null  # bo20 does not have recall

  financebench:
    path: /path/to/financebench_full
    extract_text: true
    extract_tables: true
    extract_charts: true
    extract_images: true
    extract_infographics: true
    recall_dataset: finance_bench  # Evaluator for recall testing

  # Single file example
  single:
    path: data/multimodal_test.pdf
    extract_text: true
    extract_tables: true
    extract_charts: true
    extract_images: true
    extract_infographics: true
    recall_dataset: null  # No recall evaluator for single file

# Example of a custom dataset configuration
  jensen_single:
    path: /path/to/jensen.pdf
    extract_text: true
    extract_tables: true
    extract_charts: true
    extract_images: true
    extract_infographics: true
    recall_dataset: null  # No recall evaluator for single file
